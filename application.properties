<app-navbar></app-navbar>

<!-- ✅ Toast Notification -->
<div *ngIf="toastMessage" class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 1055;">
  <div class="toast show align-items-center text-white bg-success border-0" role="alert">
    <div class="d-flex">
      <div class="toast-body">
        {{ toastMessage }}
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" (click)="toastMessage = ''"></button>
    </div>
  </div>
</div>

<div class="container">
  <div class="align-items-center justify-content-center text-center mt-3 mb-4">
    <h2 class="mb-4 text-primary">📚 Book Module</h2>
    <p class="text-muted mb-5">Manage all book-related operations from here</p>
  </div>

  <!-- 🔍 Search Bar -->
  <div class="row mb-4 mt-4 search-area align-items-center">
    <div class="col-sm-12 col-md-4 mb-2 mb-md-0">
      <select class="form-select" [(ngModel)]="searchType">
        <option value="title">Search by Title</option>
        <option value="author">Search by Author</option>
        <option value="genre">Search by Genre</option>
      </select>
    </div>
    <div class="col-sm-12 col-md-6 mb-2 mb-md-0">
      <input type="text" class="form-control" placeholder="Enter value to search" [(ngModel)]="searchValue">
    </div>
    <div class="col-sm-12 col-md-2">
      <button class="btn btn-primary w-100" (click)="searchBooks()">
        <i class="bi bi-search"></i> Search
      </button>
    </div>
  </div>

  <!-- 📚 Book Cards -->
  <div class="row">
    <ng-container *ngFor="let book of books">
      <div class="col-12 col-sm-6 col-md-4 col-lg-3 d-flex align-items-stretch mb-4">
        <div class="card shadow w-100 text-center" [ngClass]="{ 'opacity-50': book.borrowedByMe }"
          style="transition: opacity 0.3s;">
          <img
            src="https://tse1.mm.bing.net/th/id/OIP.li28PO9vkz1NQS9jN9ZOOAHaHa?w=161&h=180&c=7&r=0&o=5&dpr=1.2&pid=1.7"
            class="img-fluid rounded mt-3" alt="Book Cover" />
          <div class="card-body">
            <h4 class="text-primary fw-bold">{{ book.title }}</h4>
            <p><strong>Author:</strong> {{ book.author }}</p>
            <p><strong>Genre:</strong> {{ book.genre }}</p>
            <p><strong>ISBN:</strong> {{ book.isbn }}</p>
            <p><strong>Year:</strong> {{ book.yearPublished }}</p>
            <p><strong>Available:</strong> {{ book.availableCopies }}</p>
            <p *ngIf="book.borrowedByMe && book.returnDate">
              <strong>Return by:</strong> {{ book.returnDate }}
            </p>
          </div>

          <div class="card-footer d-flex flex-wrap justify-content-center gap-2 p-3">
            <!-- 👤 Member buttons -->
            <ng-container *ngIf="userRole === 'member'">
              <button *ngIf="!book.borrowedByMe" class="btn btn-outline-success" (click)="borrowBook(book.bookId)"
                title="Borrow Book">
                <i class="bi bi-book"></i> Borrow
              </button>
              <button *ngIf="book.borrowedByMe" class="btn btn-outline-danger" (click)="returnBook(book.bookId)"
                title="Return Book">
                <i class="bi bi-arrow-return-left"></i> Return
              </button>
            </ng-container>

            <!-- 🔧 Admin buttons -->
            <ng-container *ngIf="userRole === 'admin'">
              <button class="btn btn-outline-warning" (click)="updateBook(book.bookId)" title="Update Book">
                <i class="bi bi-pencil-square"></i> Update
              </button>
              <button class="btn btn-outline-danger" (click)="deleteBook(book.bookId)" title="Delete Book">
                <i class="bi bi-trash"></i> Delete
              </button>
            </ng-container>
          </div>
        </div>
      </div>
    </ng-container>

    <!-- ➕ Add New Book (Only for Admin) -->
    <div *ngIf="userRole === 'admin'" class="col-12 col-sm-6 col-md-4 col-lg-3 d-flex align-items-stretch mb-4">
      <div class="card add-book-card shadow w-100 text-center" routerLink="/addBook" style="cursor: pointer;">
        <div class="card-body d-flex flex-column justify-content-center align-items-center">
          <i class="bi bi-plus-circle-fill display-4 text-success mb-3"></i>
          <h5 class="text-success fw-semibold">Add New Book</h5>
          <p class="text-muted small">Click to add a new book to the library</p>
        </div>
      </div>
    </div>
  </div>

  <!-- ❗ No Results -->
  <div *ngIf="books.length === 0" class="alert alert-info text-center mt-4">
    No books found.
  </div>
</div>


<app-navbar></app-navbar>

<div class="container" style="margin-top: 100px;">
  <div class="text-center mt-3 mb-4">
    <div *ngIf="userRole === 'member'" class="alert alert-info">
      You are logged in as: <strong>{{ members[0]?.email }}</strong>
    </div>
    <div *ngIf="userRole === 'admin'" class="alert alert-primary">
      Admin Dashboard - Manage Members
    </div>
    <h2 class="text-primary">👥 Member Module</h2>
    <p class="text-muted mb-4">Manage all member-related operations from here</p>

    <!-- Add Member button for admin -->
    <button *ngIf="userRole === 'admin'" class="btn btn-success mb-4" (click)="goToAddMember()">
      ➕ Add Member
    </button>
  </div>

  <!-- Existing member card UI (unchanged) -->
  <div class="row">
    <ng-container *ngFor="let member of members">
      <div class="col-12 col-sm-6 col-md-4 col-lg-3 d-flex align-items-stretch mb-4">
        <div class="card shadow text-center w-100">
          <img src="https://cdn-icons-png.flaticon.com/512/2288/2288510.png" class="img-fluid p-3 mx-auto"
            style="height: 180px; object-fit: contain;" />
          <div class="card-body text-start">
            <h5 class="text-primary text-center">Member Details</h5>
            <p><strong>Name:</strong> {{ member.name }}</p>
            <p><strong>Email:</strong> {{ member.email }}</p>
            <p><strong>Phone:</strong> {{ member.phone }}</p>
            <p><strong>Address:</strong> {{ member.address }}</p>
            <p><strong>Status:</strong> {{ member.membershipStatus }}</p>

            <!-- Fine Info for Member -->
            <div *ngIf="userRole === 'member'" class="border border-info p-2 rounded mt-2">
              <h6 class="text-info text-center">💰 Fine Info</h6>
              <div *ngIf="fineDetails">
                <p><strong>Fine ID:</strong> {{ fineDetails.fineId }}</p>
                <p><strong>Amount:</strong> ₹{{ fineDetails.amount }}</p>
                <p><strong>Status:</strong> {{ fineDetails.status }}</p>
                <p><strong>Date:</strong> {{ fineDetails.transactionDate }}</p>
              </div>
              <div *ngIf="message" class="alert alert-success text-center p-1">{{ message }}</div>
              <div *ngIf="error" class="alert alert-danger text-center p-1">{{ error }}</div>
            </div>
          </div>

          <div class="card-footer d-flex flex-wrap justify-content-center gap-2 p-3">
            <!-- Admin actions -->
            <button *ngIf="userRole === 'admin'" class="btn btn-outline-warning"
              (click)="updateMember(member.memberId)">
              ✏️ Update
            </button>
            <button *ngIf="userRole === 'admin'" class="btn btn-outline-danger" (click)="deleteMember(member.memberId)">
              🗑️ Delete
            </button>

            <!-- Member actions -->
            <button *ngIf="userRole === 'member'" class="btn btn-outline-success" (click)="calculateFine()">
              💰 Check Fine
            </button>
            <button *ngIf="userRole === 'member'" class="btn btn-outline-primary" (click)="payFine()"
              [disabled]="!fineDetails">
              🧾 Pay Fine
            </button>
          </div>
        </div>
      </div>
    </ng-container>
  </div>

  <!-- No Members Message -->
  <div *ngIf="members.length === 0" class="alert alert-info text-center">
    No members found.
  </div>
</div>

now i need the add member ui similar to the add book ui ,
and i liked the ui ok member so just enhance the book ui
