import { Component } from '@angular/core';
import { Router, RouterLink } from '@angular/router';
import { NavbarComponent } from '../navbar/navbar.component';
import { FormsModule, NgForm } from '@angular/forms';
import { AuthService } from '../auth.service';
import { MemberService } from '../member.service';

@Component({
  selector: 'app-register',
  imports: [NavbarComponent, RouterLink, FormsModule],
  templateUrl: './register.component.html',
  styleUrl: './register.component.css'
})
export class RegisterComponent {

  constructor(private router: Router, private authService: AuthService, private memberService: MemberService) { }

  validateR(form: NgForm) {
    console.log('User Registration');

    const userPayload = {
      name: form.value.name,
      email: form.value.email,
      password: form.value.password,
      roles: form.value.roles
    };

    const memberPayload = {
      name: form.value.name,
      email: form.value.email,
        phone: form.value.phone,
        address: form.value.address,
        membershipStatus: form.value.membershipStatus
      };

    this.authService.register(userPayload).subscribe({
      next: (response) => {
        console.log('User registered:', response);

        // After successful user registration, register member
        console.log('Registering as Member');
        this.memberService.addMember(memberPayload).subscribe({
          next: (res) => {
            console.log('Member registered:', res);
            alert('Registration successful!');
            this.router.navigate(['/login']);
          },
          error: (err) => {
            console.error('Member registration failed:', err);
            alert('Member registration failed.');
          }
        });
      },
      error: (err) => {
        console.error('User registration failed:', err);
        alert('User registration failed.');
      }
    });
  }
}


